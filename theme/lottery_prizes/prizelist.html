<div class="modal-header">
    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
    <h4 class="modal-title">奖品管理</h4>
</div>
<div class="modal-body">
    <div class="row">
        <div class="col-md-12">

            <div class="table-responsive">
                <table class="table table-success mb30">
                    <thead>
                    <tr>
                        <th>排序</th>
                        <th>名字</th>
                        <th>数量</th>
                        <th>机率</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {volist name="list" id="vo" mod="2"}
                    <tr>
                        <td>{$vo.orderid}</td>
                        <td>{$vo.name}</td>
                        <td>{$vo.num}</td>
                        <td>{$vo.winning_rate}</td>
                        <td class="table-action">
                            <a href=""><i class="fa fa-pencil"></i></a>
                            <a href="" class="delete-row"><i class="fa fa-trash-o"></i></a>
                        </td>
                    </tr>
                    {/volist}

                    </tbody>
                </table>
            </div>




                <input type="hidden" id="tid" name="id" value="">
                <input type="hidden" id="lid" name="lid" value="{$temp['id']}">
                <div class="form-group">
                    <label class="col-sm-3 control-label">名字：</label>
                    <div class="col-sm-6">
                        <input type="text" placeholder="名字" id="name" name="name" value="" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">全名：</label>
                    <div class="col-sm-7">
                        <input type="text" placeholder="全名" id="allname" name="allname" value="" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">数量：</label>
                    <div class="col-sm-7">
                        <input type="text" placeholder="数量" id="num" name="num" value="" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">中奖机率：</label>
                    <div class="col-sm-7">
                        <input type="text" placeholder="中奖机率" id="winning_rate" name="winning_rate" value="" class="form-control">
                        <div class="help-block">这里写入的是百分比，如50%，在上面填写50</div>

                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">排序：</label>
                    <div class="col-sm-7">
                        <input type="text" placeholder="排序" id="orderid" name="orderid" value="" class="form-control">
                    </div>
                </div>
                <link href="/template/fileinput/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
                <div class="form-group">
                    <label class="col-sm-3 control-label">头部图片：</label>
                    <div class="col-sm-6">
                        <input id="qcode" name="picjson" value="/template/img/lottery/p1.png" type="hidden">
                        <input id="file-zh" name="upqcode" value="/template/img/lottery/p1.png" type="file" multiple>
                    </div>
                </div>

                <div class="panel-footer" style="display: block;">
                    <div class="row">
                        <div class="col-sm-6 col-sm-offset-3">
                            <button class="btn btn-primary" id="updata" type="submit">提交</button>&nbsp;
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        </div>
                    </div>
                </div><!-- panel-footer -->

        </div>
    </div>
    <!-- col-md-12 -->
</div>
</div>
<script src="/template/fileinput/fileinput.js" type="text/javascript"></script>
<script src="/template/fileinput/zh.js" type="text/javascript"></script>
<script>
    jQuery(document).ready(function () {
        var img = 1%5+1;
        $("#qcode").val("/template/img/lottery/p"+img+".png");
        $("#file-zh").val("/template/img/lottery/p"+img+".png")
        $('#file-zh').fileinput({
            language: 'zh',
            uploadUrl: '/magents/addimg.html',
            allowedFileExtensions: ['jpg', 'png', 'gif'],
            showUploadedThumbs: true,
            previewFileType: 'any',
            dropZoneEnabled: false,
            overwriteInitial: false,
            maxFileCount: 1,
            initialPreviewFileType: 'image',//图像是默认的，可以在下面的配置中重写
            purifyHtml: true,//默认情况下会纯化HTML数据以进行预览
            previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",

            initialPreview: [

                "<img src='/template/img/lottery/p1.png'  class='kv-preview-data file-preview-image' style='width:auto;height:160px;'/>",
            ],
            initialPreviewConfig: [
                {
                    caption: "/template/img/lottery/p1.png",
                    size: 26700,
                    width: "120px",
                    url: '/magents/delimg.html',
                    key: 1,
                    extra: {imgpath: '/template/img/lottery/p1.png'}
                },
            ],
            initialCaption: '/template/img/lottery/p1.png'


        }).on("fileuploaded", function (event, data, previewId, index) {
            var imgs = $('#qcode').val();
            imgs += data.response.data;
            $('#qcode').val(imgs);
            $(".file-caption-name").attr("title", imgs);
            var html = '<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>' + imgs;
            $(".file-caption-name").html(html);

        });
        $('#file-zh').on('filepredelete', function (event, key, jqXHR, data) {
            var str = $('#qcode').val();
            var splitFirst = str.split(',' + data.imgpath);
            var result = splitFirst.join('');
            $('#qcode').val(result);

            $(".file-caption-name").attr("title", result);
            var html = '<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>' + result;
            $(".file-caption-name").html(html);
            // console.log('Key = ' + key);
            // console.log(jqXHR);
            //console.log(data);
        });
        $("#updata").click(function () {
            var tid = $("#tid").val();
            var lid = $("#lid").val();
            var name = $("#name").val();
            var allname = $("#allname").val();
            var num = $("#num").val();
            var winning_rate = $("#winning_rate").val();
            var orderid = $("#orderid").val();
            var img = $("#qcode").val();

            Verification(lid,'抽奖id不能为空');
            Verification(name,'名字不能为空');
            Verification(allname,'全名不能为空');
            Verification(winning_rate,'中奖机率不能为空');
            Verification(orderid,'排序不能为空');
            Verification(img,'图片不能为空');

            var data = {
                tid: tid,
                lid: lid,
                name: name,
                allname: allname,
                num: num,
                winning_rate: winning_rate,
                orderid: orderid,
                img: img
            };
            $.ajax({
                type: "POST",
                dataType: "html",
                url: '/lotterys/addPrize',
                data: data,
                success: function (result) {
                    var strresult=result;
                    //alert(strresult);
                    console.log(strresult)
                },
                error: function(data) {
                    //alert("error:"+data.responseText);
                    console.log(data)
                }

            });

            var html = 'tid:' + tid +' lid:'+lid +' name:' + name + ' allname:'+ allname + ' num:'+num +' winning_rate:'+winning_rate + ' orderid:'+ orderid + ' img:'+ img
            console.log(html)
            
        });
        function  Verification(value,msg) {
            if(value.length==0){
                //处理
                alert(msg)
            }
        }
    });
</script>
