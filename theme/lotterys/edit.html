{include file="Public/head_base" /}

{include file="Public/menu" /}

<div class="mainpanel">

    {include file="Public/headerbar" /}
    <script src="/zx-editor/libs/zx-debug.min.js"></script>
    <!--编辑器-->
    <script src="/zx-editor/js/zx-editor.min.js"></script>
    <style>
        .zxeditor-container.fixed .zxeditor-content-wrapper {
            position: inherit;
        }

        .zxeditor-container .zxeditor-toolbar-wrapper {
            position: inherit;
        }

        .zx-eidtor-container {
            border: 1px solid #d3d7db;
        }

        .zxeditor-container {
            background: #ffffff;
        }
    </style>

    <div class="pageheader">
        <h2><i class="fa fa-table"></i> 大转盘管理 <a class="btn btn-danger" href="{:url('index/lotterys/add')}">添加大转盘</a>
        </h2>
        <div class="breadcrumb-wrapper">
            <span class="label">当前位置:</span>
            <ol class="breadcrumb">
                <li><a href="/lotterys">大转盘管理</a></li>
                <li class="active">大转盘管理</li>
            </ol>
        </div>
    </div>

    <div class="contentpanel">

        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="panel-btns">
                    <a href="" class="panel-close">×</a>
                    <a href="" class="minimize">−</a>
                </div>
                <h4 class="panel-title">大转盘编辑</h4>

            </div>
            <div class="panel-body panel-body-nopadding" style="display: block;">

                <form method="post" name="myForm" class="form-horizontal form-bordered">
                    <link href="/template/fileinput/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">头部图片：</label>
                        <div class="col-sm-6">
                            <input id="qcode" name="picjson" value="{if isset($temp['picjson'])}{$temp['picjson']}{/if}" type="hidden">
                            <input id="file-zh" name="upqcode" value="{if isset($temp['picjson'])}{$temp['picjson']}{/if}" type="file" multiple>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-3 control-label">标题：</label>
                        <div class="col-sm-6">
                            <input type="text" placeholder="标题" name="title"
                                   value="{if isset($temp['title'])}{$temp['title']}{/if}" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="disabledinput">开始时间：</label>
                        <div class="col-sm-6">
                            <div class="input-group">

                                <input type="text" class="form-control" name="startime"
                                       value="{if isset($temp['startime'])}{$temp['startime']}{/if}"
                                       placeholder="mm/dd/yyyy" id="datepicker">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            </div>

                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="disabledinput">结束时间：</label>
                        <div class="col-sm-6">
                            <div class="input-group">

                                <input type="text" class="form-control" name="endtime" alue="{if isset($temp['endtime'])}{$temp['endtime']}{/if}" placeholder="mm/dd/yyyy" id="datepicker1">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            </div>

                        </div>
                    </div>


                    {volist name="formhtml" id="vo" mod="2"}
                    <div class="form-group">
                        <label class="col-sm-3 control-label">{$vo['itemname']}：</label>
                        <div class="col-sm-6" {if $vo['itemname']=='内容'}style="position: initial"{/if}>
                        {$vo['html']}
                    </div>
            </div>
            {/volist}


            <div class="form-group">
                <label class="col-sm-3 control-label">手机号：</label>
                <div class="col-sm-6">
                    <input type="text" placeholder="手机号" name="phone" value="{if isset($temp['phone'])}{$temp['phone']}{/if}" class="form-control">
                </div>
            </div>


            <div class="panel-footer" style="display: block;">
                <div class="row">
                    <div class="col-sm-6 col-sm-offset-3">

                        <button class="btn btn-primary" type="submit">提交</button>&nbsp;
                        <button class="btn btn-default" type="reset">取消</button>
                    </div>
                </div>
            </div><!-- panel-footer -->

        </div>

        </form>

    </div><!-- panel-body -->


    <!-- row -->
</div><!-- contentpanel -->

</div><!-- mainpanel -->







<script src="/template/js/jquery-1.11.1.min.js"></script>
<script src="/template/js/jquery-migrate-1.2.1.min.js"></script>
<script src="/template/js/bootstrap.min.js"></script>
<script src="/template/js/modernizr.min.js"></script>
<script src="/template/js/jquery.sparkline.min.js"></script>
<script src="/template/js/toggles.min.js"></script>
<script src="/template/js/retina.min.js"></script>
<script src="/template/js/jquery.cookies.js"></script>


<script src="/template/js/jquery-ui-1.10.3.min.js"></script>
<!--<script src="/template/js/select2.min.js"></script>-->

<script src="/template/js/custom.js"></script>

<style>
    .form-control.file-caption.kv-fileinput-caption {
        padding: 7px;
    }

    .form-control.file-caption.kv-fileinput-caption .file-caption-name {
        line-height: 25px;
    }
</style>
<script src="/template/fileinput/fileinput.js" type="text/javascript"></script>
<script src="/template/fileinput/zh.js" type="text/javascript"></script>

<script>
    jQuery(document).ready(function () {

        "use strict";
        // Date Picker
        jQuery('#datepicker').datepicker();
        jQuery('#datepicker1').datepicker();
        jQuery('#datepicker2').datepicker();

        $("#area1").change(function () {
            selectarea(2, $("#area1").val());
        });
        $("#area2").change(function () {
            selectarea(3, $("#area2").val());
        });

        $("#area3").change(function () {
            selectarea(4, $("#area3").val());
        });

        $("#area4").change(function () {
            $("#area").val($(this).val())
        });

        function selectarea(type, supid) {

            $.get("/magents/getajaxarea/type/" + type + "/supid/" + supid, function (data, status) {
                var html = '';
                for (var i = 0; i < +data.length; i++) {
                    html += '<option value=\"' + data[i].id + '\">' + data[i].name + '</option>';
                }
                $("#area" + (type)).html(html);
                if (type == 2) {
                    if (html == '') {
                        $("#area" + (type + 1)).html(html);
                        $("#area").val(supid);
                    } else {
                        selectarea(3, data[0].id);
                    }

                }
                if (type == 3) {
                    if (html == '') {
                        $("#area").val(supid)
                    } else {
                        $("#area").val([data[0].id])
                        selectarea(4, data[0].id)
                    }
                }
                if (type == 4) {
                    if (html == '') {
                        $("#area").val(supid)
                    } else {
                        $("#area").val([data[0].id])
                        //selectarea(3,data[0].id)
                    }
                }
            });
        }

        $("#sid").change(function () {
            var d = {"sid": $(this).val()};
            $.post("{:url('index/lotterys/ajaxsorttype')}", d, function (result) {
                var obj = JSON.parse(result);
                if (obj.status == 1) {
                    $("#content").hide();
                    $("#wechat").hide();
                    $("#address").hide();
                    $.each(obj.data, function (name, value) {
                        $("#" + name).show();
                        $("#" + name + "-title").html(value + "：");
                    });
                } else {
                    $("#sidinfo").html(obj.msg);
                }

            });
        });
    });
    $('#file-zh').fileinput({
        language: 'zh',
        uploadUrl: '/magents/addimg.html',
        allowedFileExtensions: ['jpg', 'png', 'gif'],
        showUploadedThumbs: true,
        previewFileType: 'any',
        dropZoneEnabled: false,
        overwriteInitial: false,
        maxFileCount: 1,
        initialPreviewFileType: 'image',//图像是默认的，可以在下面的配置中重写
        purifyHtml: true,//默认情况下会纯化HTML数据以进行预览
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",

        initialPreview: [

            "<img src='/template/img/lottery/01.jpg'  class='kv-preview-data file-preview-image' style='width:auto;height:160px;'/>",
        ],
        initialPreviewConfig: [

            {
                caption: "/template/img/lottery/01.jpg",
                size: 26700,
                width: "120px",
                url: '/magents/delimg.html',
                key: 1,
                extra: {imgpath: '/template/img/lottery/01.jpg'}
            },
        ],
        initialCaption: '/template/img/lottery/01.jpg'


    }).on("fileuploaded", function (event, data, previewId, index) {
        var imgs = $('#qcode').val();
        imgs += data.response.data;
        $('#qcode').val(imgs);
        $(".file-caption-name").attr("title", imgs);
        var html = '<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>' + imgs;
        $(".file-caption-name").html(html);

    });
    $('#file-zh').on('filepredelete', function (event, key, jqXHR, data) {
        var str = $('#qcode').val();
        var splitFirst = str.split(',' + data.imgpath);
        var result = splitFirst.join('');
        $('#qcode').val(result);

        $(".file-caption-name").attr("title", result);
        var html = '<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>' + result;
        $(".file-caption-name").html(html);
        // console.log('Key = ' + key);
        // console.log(jqXHR);  
        //console.log(data); 
    });
</script>

</body>
</html>


